<!DOCTYPE html>
<html lang="en">
<head>
    <title>Serendipity Styx Edition - Help Center [en] | Code primers | ophian.github.io</title>
    <meta charset="UTF-8">
    <meta name="description" content="Serendipity Styx is a PHP-powered weblog engine giving users an easy way to maintain a blog and developers a framework with the power for professional applications.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Serendipity Styx Edition - Help Center [en] | Code primers | Styx is what Serendipity should be | ophian.github.io">
    <meta property="og:site_name" content="Serendipity Styx Blog System">
    <meta property="og:description" content="Serendipity Styx is a PHP-powered weblog engine giving users an easy way to maintain a blog and developers a framework with the power for professional applications.">
    <meta property="og:image" content="https://ophian.github.io/i/styx-opengraph.jpg">
    <meta property="og:url" content="https://ophian.github.io/hc/en/code-primer.html">
    <link rel="canonical" href="https://ophian.github.io/hc/en/code-primer.html">
    <link rel="apple-touch-icon" href="/i/apple-touch-icon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito|Nunito+Sans">
    <link rel="stylesheet" href="/css/libs.min.css">
    <link rel="stylesheet" href="/css/styx.min.css">
</head>
<body>
<ul class="skip-link__list">
    <li class="skip-link skip-link--main-nav">
        <a href="#main-navigation" tabindex="1">Main navigation</a>
    </li>
    <li class="skip-link skip-link--main-repo"><a href="#main-repository" tabindex="1">Styx Repository</a></li>
    <li class="skip-link skip-link--main-content"><a href="#main-content" tabindex="1">Styx Main content</a></li>
</ul>
<div class="menu menu--no-hero menu--tiny ">
    <div class="menu__page-title">
        <h1><a href="/hc/en">Serendipity Styx Edition - Documentation [en]</a></h1>
    </div>
    <div class="progress-bar" aria-hidden="true"><span class="progress-bar__fill"></span></div>
</div>
<div class="site-nav site-nav--no-hero menu--tiny">
    <button class="site-nav__toggler" id="site-nav__toggler" aria-label="Show website navigation" aria-expanded="false" tabindex="1">
        <span class="bar" aria-hidden="true"></span>
        <span class="bar" aria-hidden="true"></span>
        <span class="bar" aria-hidden="true"></span>
    </button>
</div>
<div class="site-nav__panel" aria-hidden="true" aria-controls="site-nav__toggler">
    <nav id="main-navigation" role="navigation" aria-label="main navigation">
        <ul class="site-nav__menu">
            <li class="site-nav__menu-item site-nav__menu-item--current"><a href="/hc/en" tabindex="-1" title="Serendipity Styx Help Center [en]">Documentation [en]</a></li>
        </ul>
        <p class="site-nav__menu-category">Main</p>
        <ul class="site-nav__menu" aria-label="links to styx site main pages">
            <li class="site-nav__menu-item"><a href="/" tabindex="-1" title="Serendipity Styx Home">Styx Home</a></li>
            <li class="site-nav__menu-item"><a href="/blog/" tabindex="-1" title="Serendipity Styx Blog">Styx Blog</a></li>
            <li class="site-nav__menu-item"><a href="/blog/archives/" tabindex="-1" title="Serendipity Styx Blog Archives">Styx Blog Archives</a></li>
            <li class="site-nav__menu-item"><a href="/atom.xml" tabindex="-1" title="Serendipity Styx Blog Feed">Styx Blog Feed</a></li>
            <li class="site-nav__menu-item"><a href="/about/" tabindex="-1" title="About Serendipity Styx">About Styx</a></li>
        </ul>
        <p class="site-nav__menu-category">Spartacus</p>
        <ul class="site-nav__menu" aria-label="links to styx spartacus pages">
            <li class="site-nav__menu-item"><a href="/plugins/" tabindex="-1" title="Serendipity Styx Spartacus Plugins">Styx Spartacus Plugins</a></li>
            <li class="site-nav__menu-item"><a href="/themes/" tabindex="-1" title="Serendipity Styx Spartacus Themes">Styx Spartacus Themes</a></li>
        </ul>
        <p class="site-nav__menu-category">Repository</p>
        <ul class="site-nav__menu" aria-label="links to styx repository pages">
            <li class="site-nav__menu-item"><a class="icon icon--small" href="https://github.com/ophian/styx" target="_blank" rel="noopener" tabindex="-1" title="GitHub Serendipity Styx Code"><svg class="icon__body"><use xlink:href="#github"></use></svg> Styx Code</a></li>
            <li class="site-nav__menu-item"><a class="icon icon--small" href="https://github.com/ophian/styx/releases" target="_blank" rel="noopener" tabindex="-1" title="GitHub Serendipity Styx Releases"><svg class="icon__body"><use xlink:href="#github"></use></svg> Styx Downloads</a></li>
            <li class="site-nav__menu-item"><a class="icon icon--small" href="https://github.com/ophian/additional_plugins" target="_blank" rel="noopener" tabindex="-1" title="GitHub Serendipity Styx Plugins"><svg class="icon__body"><use xlink:href="#github"></use></svg> Styx Plugins</a></li>
            <li class="site-nav__menu-item"><a class="icon icon--small" href="https://github.com/ophian/styx/issues" target="_blank" rel="noopener" tabindex="-1" title="GitHub Serendipity Styx Issues"><svg class="icon__body"><use xlink:href="#github"></use></svg> Styx Issues</a></li>
        </ul>
        <p class="site-nav__menu-category">Book</p>
        <ul class="site-nav__menu" aria-label="link book page">
            <li class="site-nav__menu-item"><a href="/book/" tabindex="-1" title="Documentation Serendipity Styx Book [de] page">Styx Book [de]</a></li>
        </ul>
        <p class="site-nav__menu-category">Connect & Help</p>
        <ul class="site-nav__menu" aria-label="links connect and help pages">
            <li class="site-nav__menu-item"><a href="/hc/" tabindex="-1" title="Serendipity Styx Help Center">Help center</a></li>
            <li class="site-nav__menu-item"><a href="/hc/de/" tabindex="-1" title="Serendipity Styx Hilfeseiten">Hilfeseiten</a></li>
            <li class="site-nav__menu-item"><a href="/hc/en/faq/" tabindex="-1" title="Serendipity Styx FAQ">Styx FAQ</a></li>
            <li class="site-nav__menu-item"><a href="/contact/" tabindex="-1" title="Serendipity Styx Contact">Contact Styx</a></li>
        </ul>
    </nav>
</div>
<div class="site-cover"></div>
<main class="site-content site-content--col site-content--no-hero site-content--simple" id="main-content" role="main">
    <section class="section site-col" data-reading-progress="true">
        <div class="col">
            <div class="col-menu__wrapper">
                <nav class="col-menu" role="navigation" aria-label="Help Center [en] documents navigation">
                    <ul>
                        <li><a href="/hc/"><img src="/i/info_icon-64.png" width="32" height="32"> Styx Help Center</a></li>
                        <li><a href="/hc/en/">Documentation [en]</a></li>
                        <li><a href="/hc/de/">Dokumentation [de]</a></li>
                        <li><a href="/hc/en/faq/">Styx Help Center FAQ</a></li>
                    </ul>
                </nav>
            </div>
            <div class="col-document__wrapper col-document__wrapper-documents">
                <div class="col-document">
                    <h1><span class="hc-home"><a href="index.html" title="Styx Help Center [en] - Documentation">⌘</a></span> Styx - Code primers</h1>
                    <h2>Code primers</h2>

<ul id="markdown-toc">
  <li><a href="#docs-the-core" id="toc-docs-the-core">The “core”</a>
    <ul>
      <li><a href="#docs-initializing-the-framework-serendipity_configincphp-and-serendipity_config_localincphp" id="toc-docs-initializing-the-framework-serendipity_configincphp-and-serendipity_config_localincphp">Initializing the Framework: serendipity_config.inc.php and serendipity_config_local.inc.php</a></li>
      <li><a href="#docs-htaccess" id="toc-docs-htaccess">.htaccess</a></li>
      <li><a href="#docs-serendipitycssphp" id="toc-docs-serendipitycssphp">serendipity.css.php</a></li>
      <li><a href="#docs-deployment-directory" id="toc-docs-deployment-directory">deployment directory</a></li>
      <li><a href="#docs-composer--bundled-libs" id="toc-docs-composer--bundled-libs">Composer / Bundled-Libs</a></li>
      <li><a href="#docs-internationalization" id="toc-docs-internationalization">Internationalization</a></li>
      <li><a href="#docs-other-files-and-directories" id="toc-docs-other-files-and-directories">Other files and directories</a></li>
      <li><a href="#docs-database-layers" id="toc-docs-database-layers">Database layers</a></li>
      <li><a href="#docs-important-variables-and-constants" id="toc-docs-important-variables-and-constants">Important variables and constants</a>
        <ul>
          <li><a href="#docs-local-configuration" id="toc-docs-local-configuration">Local configuration</a></li>
          <li><a href="#docs-personal-configuration" id="toc-docs-personal-configuration">Personal Configuration</a></li>
        </ul>
      </li>
      <li><a href="#docs-important-api-functions" id="toc-docs-important-api-functions">Important API functions</a></li>
      <li><a href="#docs-error-handling" id="toc-docs-error-handling">Error-Handling</a></li>
    </ul>
  </li>
  <li><a href="#docs-frontend-routing-indexphp" id="toc-docs-frontend-routing-indexphp">Frontend-Routing: index.php</a>
    <ul>
      <li><a href="#docs-archive-view" id="toc-docs-archive-view">Archive view</a></li>
      <li><a href="#docs-external-plugin" id="toc-docs-external-plugin">External plugin</a></li>
    </ul>
  </li>
  <li><a href="#docs-backend-routing-serendipity_adminphp" id="toc-docs-backend-routing-serendipity_adminphp">Backend-Routing: serendipity_admin.php</a>
    <ul>
      <li><a href="#docs-backend-modules" id="toc-docs-backend-modules">Backend Modules</a></li>
      <li><a href="#docs-importers--exporters" id="toc-docs-importers--exporters">Importers / Exporters</a></li>
    </ul>
  </li>
  <li><a href="#docs-plugins" id="toc-docs-plugins">Plugins</a></li>
  <li><a href="#docs-themes" id="toc-docs-themes">Themes</a></li>
  <li><a href="#docs-coding-guidelines" id="toc-docs-coding-guidelines">Coding Guidelines</a></li>
</ul>

<p>To get started with developing Serendipity, here’s a few things to get you kickstarted.</p>

<p>The first thing you need is an installation of Serendipity, and FTP/SSH file access to that installation. It’s easy to setup a local Apache server with PHP and MySQL on all Linux, MacOS or Windows systems. Of course the best thing would be if you use github to check out our core code, so you can easily contribute patches or update your installation to the latest code version.</p>

<p>Now here are the most basic concepts you need to know. Those assume you have some basic PHP knowledge, and you are comfortable with reading the PHP code of the files alongside. The best way is always learning-by-doing when working with an existing system, so our goal is not to teach you all the basics - but rather to get you to know the basic workflows, so that you can check them out easily on your own, and know where to find what.</p>

<p>All our core PHP functions (serendipity_XXX) have phpDoc style comments which explain the parameters and functionality of each function, so be sure to read those. We currently have no automated Code documentation, but you should be able to use any phpDoc compiler on our code yourself.</p>

<h3 id="docs-the-core" class="hspace">The “core”</h3>

<h4 id="docs-initializing-the-framework-serendipity_configincphp-and-serendipity_config_localincphp">Initializing the Framework: serendipity_config.inc.php and serendipity_config_local.inc.php</h4>

<p>The user configuration for the most basic settings required to start the framework lies in <strong>serendipity_config_local.inc.php</strong>. It sets up the basic array <code>$serendipity</code>, and configure database credentials and the used Serendipity version.</p>

<p>The file <strong>serendipity_config.inc.php</strong> is the heart of our framework. It sets default variables, checks the PHP environment, loads the user configuration, includes the required files.</p>

<p>Whenever you want to do “something” with the Serendipity framework, all you need to do is include that file <strong>serendipity_config.inc.php</strong> in your code, and you can immediately access most of the Serendipity function calls, like this:</p>

<pre><code>&lt;?php
include 'serendipity_config.inc.php';
$entries = serendipity_fetchEntries();
print_r($entries);
?&gt;</code></pre>

<p>The defined variables in this file by default are:</p>

<ul class="plainList">
  <li><code>$serendipity['versionInstalled']</code>: Current version number</li>
  <li><code>$serendipity['dbName']</code>: Database name</li>
  <li><code>$serendipity['dbPrefix']</code>: Database prefix (preceded before internal table names)</li>
  <li><code>$serendipity['dbHost']</code>: Database host</li>
  <li><code>$serendipity['dbUser']</code>: Database user</li>
  <li><code>$serendipity['dbPass']</code>: Database password</li>
  <li><code>$serendipity['dbType']</code>: Database type (=layer)</li>
  <li><code>$serendipity['dbPersistent']</code>: Whether to use persistent connections</li>
</ul>

<p>On top of that, certain variables that are not included in the Serendipity Configuration panel can be configured in this file; If they are not present, the Serendipity defaults will be used. Such variables are:</p>

<ul class="plainList">
  <li><code>$serendipity['production']</code>: If set to “false” you can evoke extra debugging output when errors occur. If set to “debug”, it will be extra-verbose. (default: based on version, RC and alpha/betas default to false)</li>
  <li><code>$serendipity['allowDateManipulation']</code>: If set to true (default), users can change the date of entries</li>
  <li><code>$serendipity['max_last_modified']</code>: Amount of seconds how fresh an article must be, so that a comment to an entry will modify its LastModified-timestamp (default: 7 days)</li>
  <li><code>$serendipity['max_fetch_limit']</code>: In RSS-Feeds, how many entries can be fetched (default 50)</li>
  <li><code>$serendipity['trackback_filelimit']</code>: How large may an URL be to check for incoming trackback links (default 150kb)</li>
  <li><code>$serendipity['fetchLimit']</code>: How many entries to display (default 15)</li>
  <li><code>$serendipity['RSSfetchLimit']</code>: How many entries to display within RSS feed (default 15)</li>
  <li><code>$serendipity['CBAfetchLimit']</code>: [Styx 2.6.dev+] How many comments to display within comments_by_author shortcut pages (default 10)</li>
  <li><code>$serendipity['use_PEAR']</code>: By default, Serendipity will use externally provided PEAR files (if existing). To force using the PEAR libraries bundled with Serendipity, set this variable to FALSE.</li>
  <li><code>$serendipity['useHTTP-Auth']</code>: If enabled (on by default, requires mod_php), users can log in to the Blog by specifying user/password in the URL like <strong>http://user:password@example.com/serendipity_admin.php</strong> (default true)</li>
  <li><code>$serendipity['cacheControl']</code>: (default true)</li>
  <li><code>$serendipity['expose_s9y']</code>: Whether to expose Serendipity version number (default true)</li>
  <li><code>$serendipity['forceBase64']</code>: When enabled, mails are encoded with base64 instead of imap_8bit (default false)</li>
  <li><code>$serendipity['use_iframe']</code>: When enabled, uses an IFRAME to save entries in the Backend to prevent timeouts (default true)</li>
  <li><code>$serendipity['autolang']</code>: Default language, when autodetection fails (default “en”)</li>
  <li><code>$serendipity['defaultTemplate']</code>: Which template directory to use for fallback chaining (see below) (default “2k11”)</li>
  <li><code>$serendipity['template_backend']</code>: Which Backend template to use when none is configured (default “2k11”)</li>
  <li><code>$serendipity['backendBlogtitleFirst']</code>: If true, the page titles of Backend pages will have the form “Blog title | Backend section name” instead of “Backend section name | Blog title” (default false). <strong>Serendipity Styx</strong> has this order “section | admin | Blog title” (eg. “Plugins | Serendipity Administration Suite | John Doe Blog”) set as default.</li>
  <li><code>$serendipity['dashboardCommentsLimit']</code>: How many comments to show in the dashboard overview (default 5)</li>
  <li><code>$serendipity['dashboardEntriesLimit']</code>: How many future entries and drafts to show in the dashboard overview (default 5)</li>
  <li><code>$serendipity['languages']</code>: Holds an array of available languages</li>
  <li><code>$serendipity['calendars']</code>: Holds an array of available calendar types (gregorian and persian by default)</li>
  <li><code>$serendipity['charsets']</code>: Holds an array of supported charsets (native and UTF-8 by default)</li>
  <li><code>$serendipity['use_autosave']</code>: Whether to use local-browser autosaving feature (default true)</li>
  <li><code>$serendipity['imagemagick_nobang']</code>: When enabled, ImageMagick image resizing operates with comma values, which can change the given image w/h setting by 1px by rounding differences (default false)</li>
  <li><code>$serendipity['imagemagick_thumb_parameters']</code>: Optional parameters passed to ImageMagick when creating thumbnails (default empty)</li>
  <li><code>$serendipity['logLevel']</code>: If set, enables using the Katzgrau KLogger (writes to “templates_c/logs/”). If set to “debug”, be extra verbose (default: ‘Off’)</li>
</ul>

<h4 id="docs-htaccess">.htaccess</h4>

<p>This file holds simple, central mod_rewrite RewriteRules (when URL-Rewriting is enabled) to match all permalink patters back to index.php (see the “Routing”-<a href="#docs-frontend-routing-indexphp">parts</a> (<a href="#docs-backend-routing-serendipity_adminphp">ff</a>) below).</p>

<h4 id="docs-serendipitycssphp">serendipity.css.php</h4>

<p>This file is usually called through the URL RewriteRules, and dynamically assembles the CSS statements for a selected theme as well as all plugins that have distinct CSS output.</p>

<h4 id="docs-deployment-directory">deployment directory</h4>

<p>Serendipity supports the concept of a “shared installation”. This keeps Serendipity as a kind of library in a central directory outside the DocumentRoot. Each Blog will then only use stub-files which actually include that library file. The deployment-Directory contains exactly those stubs that point back to the library (through simply “include” calls). Note that the file names are exactly those that the core actually uses.</p>

<p>For more information, see <a href="shared-installation.html">Setting up a shared installation</a>.</p>

<h4 id="docs-composer--bundled-libs">Composer / Bundled-Libs</h4>

<p>The directory <strong>bundled-libs</strong> holds all of our internally used libraries that ship together with Serendipity. Using composer, we are able to update those libraries (in part). However, note that composer is NOT required to develop with Serendipity, since the libraries are all contained in our source code repository. Developers note, that Styx has removed the roots executing composer.phar file, since not maintained. Take your own!</p>

<p>We currently bundle:</p>

<ul>
  <li><strong>PEAR</strong> for some legacy libraries:
    <ul>
      <li><strong>PEAR::Cache</strong> for some easy File/function caching</li>
      <li><strong>PEAR::HTTP</strong> for some basic HTTP Request and Response classes</li>
      <li><strong>PEAR::Net</strong> for some basic HTTP operations, related to PEAR::HTTP</li>
      <li><strong>PEAR::Text</strong> for basic Text/Wiki operations</li>
      <li><strong>PEAR::XML</strong> for XML operations</li>
    </ul>
  </li>
  <li><strong>Onyx</strong> for RSS parsing</li>
  <li><strong>simplepie</strong> for advanced Atom and RSS parsing</li>
  <li><strong>Smarty</strong> for our templating infrastructure</li>
  <li><strong>composer</strong> for library maintenance</li>
  <li><strong>katzgrau/klogger</strong>, <strong>psr</strong> as a central low-level logging facility</li>
  <li><strong>zendframework/zend-db/</strong> as an (optional) database layer intermediate</li>
  <li><strong>create_release.sh</strong> is the script we use to bundle releases</li>
  <li><strong>serendipity_generateFTPChecksums.php</strong> is the code used by the “create_release.sh” to create the integrity <strong>checksums.inc.php</strong> file</li>
</ul>

<h4 id="docs-internationalization">Internationalization</h4>

<p>Serendipity’s translations are handled through easy “.php” include files inside the <strong>lang/</strong> subdirectory. Each language has its own file according to its country code.</p>

<p>Translation files can have a “local charset” file and a UTF-8 variant in the UTF-8 subdirectory.</p>

<p>The file “addlang.txt” is meant for developers to hold new strings; By running “addlang.sh” this list can be integrated into each language file.</p>

<p>Some special constants / variables inside the language files are these:</p>

<ul class="plainList">
  <li><code>$i18n_filename_from</code>: Holds an array of character replacements, which will replaced with ASCII characters when they occur within a URL. This can be used to translate umlauts etc. to “readable” variants of those, like a german “Ü” gets translated to “Ue”.</li>
  <li><code>$i18n_filename_to</code>: This holds the actual character replacement values.</li>
  <li><strong>LANG_CHARSET</strong>: Central constant that indicates the used charset of a language. Many plugins etc. use this to deduce which</li>
  <li><strong>SQL_CHARSET</strong>: Default charset for database connection</li>
  <li><strong>DATE_LOCALES</strong>: Used locales for a language</li>
  <li><strong>DATE_FORMAT_ENTRY</strong>: The dateformat used in the language</li>
  <li><strong>DATE_FORMAT_SHORT</strong>: A short dateformat used in the language</li>
  <li><strong>WYSIWYG_LANG</strong>: Which language file include is used by CKEditor</li>
  <li><strong>NUMBER_FORMAT_DECIMALS</strong>, <strong>NUMBER_FORMAT_DECPOINT</strong>, <strong>NUMBER_FORMAT_THOUSANDS</strong>: Some default number formatting rules</li>
  <li><strong>LANG_DIRECTION</strong>: Indicates if a language uses rtl or ltr spelling</li>
</ul>

<p>Certain language constants can use placeholders like “%s” (standard PHP sprintf()) for later variable inclusion.</p>

<p>The proper language in the codeflow is loaded through “include/lang.inc.php”. This file is called twice; Once for the central routine to only detect the proper language, and then a second time to actually load all language constants for the currently-logged in user.</p>

<h4 id="docs-other-files-and-directories">Other files and directories</h4>

<p>There are a couple of other files in the Serendipity root that are basic stubs which all reference the core framework:</p>

<ul>
  <li><strong>index.php</strong>: Frontend (see below)</li>
  <li><strong>.htaccess</strong>: Webserver configuration (see above)</li>
  <li><strong>serendipity_admin.php</strong>: Backend (see below)</li>
  <li><strong>serendipity_config.inc.php</strong>: Framework initializing (see above)</li>
  <li><strong>serendipity_config_local.inc.php</strong>: Basic configuration of the Blog</li>
  <li><strong>comment.php</strong>, <strong>wfwcomment.php</strong>: Used to accept and process a comment or trackback made to Blog entries</li>
  <li><strong>checksums.inc.php</strong>: A checksum file that holds information about the files that belong to the current Serendipity version; It is used to verify the integrity of an installation to find modified files.</li>
  <li><strong>exit.php</strong>: A tracking script used for external links</li>
  <li><strong>rss.php</strong>: The RSS feeds are routed through this</li>
  <li><strong>serendipity_admin_image_selector.php</strong>: A media database popup screen that is called from within the Backend</li>
  <li><strong>serendipity_xmlrpc.php</strong>: A basic stub for XML-RPC calls made to the Blog, the actual XML-RPC client is provided through a plugin</li>
</ul>

<p>The subdirectories contain:</p>

<ul>
  <li><strong>archives/</strong>: A temporary directory used to hold static files</li>
  <li><strong>uploads/</strong>: Directory to contain user/media files</li>
  <li><strong>bundled-libs/</strong>: External libraries like Smarty and other (see above)</li>
  <li><strong>deployment/</strong>: Stub directory for shared installations (see above)</li>
  <li><strong>docs/</strong>: ChangeLog and other documentation</li>
  <li><strong>htmlarea/</strong>: Bundled CKEditor WYSIWYG</li>
  <li><strong>include/</strong>: Internal code libraries</li>
  <li><strong>include/admin/</strong>: Code workflow used for Backend (see below)</li>
  <li><strong>include/admin/importers/</strong>: Data export/import modules (see below)</li>
  <li><strong>include/db/</strong>: Code libraries for database layers</li>
  <li><strong>include/tpl/</strong>: Configuration templates for Backend functionality</li>
  <li><strong>lang/</strong>: PHP language files (using simple constants)</li>
  <li><strong>plugins/</strong>: Plugin files</li>
  <li><strong>sql/</strong>: SQL database creation files</li>
  <li><strong>templates/</strong>: Theme files</li>
  <li><strong>templates_c/</strong>: Compile directory for cached templates (and other temporary data)</li>
  <li><strong>tests/</strong>: Draft ideas for unit tests</li>
</ul>

<h4 id="docs-database-layers">Database layers</h4>

<p>The database layer offers a central framework through <em>“include/db/db.inc.php”</em>. Serendipity uses plain SQL statements for its queries. We try to use database-agnostic standard SQL wherever possible, so that it runs on most servers.</p>

<p>If that is not possible, certain code-forks are deployed to use specific queries for specific database layers; However, those places are very few. The advantage of using central SQL is that it also creates very readable, easy SQL.</p>

<p>Core functions available globally across all database layers are:</p>

<ul>
  <li><strong>serendipity_db_update</strong>: Perform a query to update the data of a certain table row</li>
  <li><strong>serendipity_db_insert</strong>: Perform a query to insert an associative array into a specific SQL table</li>
  <li><strong>serendipity_db_bool</strong>: Check whether an input value corresponds to a TRUE/FALSE option in the SQL database.</li>
  <li><strong>serendipity_db_get_interval</strong>: Return a SQL statement for a time interval or timestamp, specific to certain SQL backends</li>
  <li><strong>serendipity_db_implode</strong>: Operates on an array to prepare it for SQL usage.</li>
</ul>

<p>We offer those database layers, which all implement an identical interface accross all layers:</p>

<ul>
  <li><strong>generic</strong>: zendframework-DB adapter</li>
  <li><strong>mysql</strong>: MySQL databases</li>
  <li><strong>mysqli</strong>: MySQL databases (PHP 5.5+ compatible Backend, better performance)</li>
  <li><strong>pdo-postgres</strong>: PDO-Postgresql driver (requires PHP PDO extension)</li>
  <li><strong>pdo-sqlite</strong>: PDO-sqlite driver (requires PHP PDO extension)</li>
  <li><strong>postgres</strong>: native postgresql driver (requires PHP extension)</li>
  <li><strong>sqlite</strong>: native sqlite driver (requires PHP sqlite extension)</li>
  <li><strong>sqlite3</strong>: native sqlite3 driver (requires PHP sqlite3 extension)</li>
  <li><strong>sqlite3oo</strong>: native sqlite3 driver using Object-Oriented interface (requires PHP sqlite3 extension)</li>
  <li><strong>sqlrelay</strong>: DB adapter using “sqlrcon” PHP extension</li>
</ul>

<p>Those layers implement these central functions:</p>

<ul>
  <li><strong>serendipity_db_query</strong>: Perform a DB Layer SQL query.</li>
  <li><strong>serendipity_db_escape_string</strong>: Returns a escaped string, so that it can be safely included in a SQL string encapsulated within quotes, without allowing SQL injection.</li>
  <li><strong>serendipity_db_limit</strong>: Returns the option to a LIMIT SQL statement, because it varies across DB systems</li>
  <li><strong>serendipity_db_limit_sql</strong>: Return a LIMIT SQL option to the DB Layer as a full LIMIT statement</li>
  <li><strong>serendipity_db_schema_import</strong>: Prepares a Serendipity query input to fully valid SQL. Replaces certain “template” variables.</li>
  <li><strong>serendipity_db_connect</strong>: Connect to the configured Database</li>
  <li><strong>serendipity_db_probe</strong>: Try to connect to the configured Database (during installation)</li>
  <li><strong>serendipity_db_reconnect</strong>: Reconnect to the configured Database</li>
  <li><strong>serendipity_db_insert_id</strong>: Returns the latest INSERT_ID of an SQL INSERT INTO command, for auto-increment columns</li>
  <li><strong>serendipity_db_affected_rows</strong>: Returns the number of affected rows of a SQL query</li>
  <li><strong>serendipity_db_updated_rows</strong>: Returns the number of updated rows in a SQL query</li>
  <li><strong>serendipity_db_matched_rows</strong>: Returns the number of matched rows in a SQL query</li>
  <li><strong>serendipity_db_begin_transaction</strong>: Tells the DB Layer to start a DB transaction.</li>
  <li><strong>serendipity_db_end_transaction</strong>: Tells the DB Layer to end a DB transaction.</li>
  <li><strong>serendipity_db_in_sql</strong>: Assemble and return SQL condition for a “IN (…)” clause</li>
  <li><strong>serendipity_db_concat</strong>: Returns the SQL code used for concatenating strings</li>
</ul>

<p>The database structure of Serendipity tries to be self-explanatory. For a list of all Serendipity database tables check out our <a href="database.html">Database structure documentation</a>.</p>

<h4 id="docs-important-variables-and-constants">Important variables and constants</h4>

<p>Core variables are:</p>

<ul class="plainList">
  <li><strong>S9Y_DATA_PATH</strong>: If a shared installation is used, points to the directory where Serendipity keeps its per-user files</li>
  <li><strong>S9Y_INCLUDE_PATH</strong>: Path to the core installation of Serendipity</li>
  <li><strong>S9Y_PEAR_PATH</strong>: Path to the bundled PEAR libraries of Serendipity</li>
  <li><strong>IS_installed</strong>: Boolean variable to indicate if Serendipity is properly installed</li>
  <li><strong>IN_serendipity</strong>: Boolean variable to indicate if the Serendipity Framework is loaded</li>
  <li><strong>IS_up2date</strong>: Boolean variable to indicate if the current Serendipity version matches the local files</li>
  <li><strong>PATH_SMARTY_COMPILE</strong>: Path to the folder where temporary Smarty files are kept</li>
  <li><strong>USERLEVEL_ADMIN</strong> (255), <strong>USERLEVEL_CHIEF</strong> (1), <strong>USERLEVEL_EDITOR</strong> (0): Constants for user permission levels</li>
  <li><code>$serendipity['rewrite']</code>: Indicates which URL rewriting method is used (none, apache errorhandling, mod_rewrite, …)</li>
  <li><code>$serendipity['serendipityPath']</code>: Contains the path to the current Serendipity installation</li>
  <li><code>$serendipity['serendipityHTTPPath']</code>: Contains the URL path to the current Serendipity installation</li>
  <li><code>$serendipity['baseURL']</code>: Contains the absolute URL to the current Serendipity installation</li>
  <li><code>$serendipity['serendipityAuthedUser']</code>: Boolean variable which indicates if a user is logged in</li>
  <li><code>$serendipity['user']</code>: The ID of the currently logged-in user</li>
  <li><code>$serendipity['email']</code>: The email address of the currently logged-in user</li>
  <li><code>$serendipity['smarty']</code>: The central Smarty object</li>
  <li><code>$serendipity['logger']</code>: The central logger object (only exists if logging is enabled)</li>
  <li><code>$serendipity['uriArguments']</code>: Contains the currently parsed URI arguments to a page call</li>
  <li><code>$serendipity['lang']</code>: Which language is currently loaded</li>
  <li><code>$serendipity['charset']</code>: Which charset is currently loaded</li>
</ul>

<p>Some important URL variables (note that if those specific variables are submitted via POST they get automatically merged into the GET array and acts like a $_REQUEST superglobal):</p>

<ul class="plainList">
  <li><code>$serendipity['GET']['action']</code>: Indicates which action on the Frontend shall be executed (i.e. “read”, “search”, “comments”, “archives”, …) and is evaluated by “include/genpage.inc.php”.</li>
  <li><code>$serendipity['GET']['adminModule']</code>: Indicates which module of the Backend shall be executed (i.e. “maintenance”, “comments”, “entries”, …) and is evaluated by “serendipity_admin.php”, which includes the specific module from “include/admin/”.</li>
  <li><code>$serendipity['GET']['adminAction']</code>: Indicates which action of a requested module on the Frontend shall be executed; The performed action is evaluated by the specific module that it is a part of.</li>
  <li><code>$serendipity['GET']['id']</code>: If supplied, applies to a specific entry ID (both Backend and Frontend)</li>
  <li><code>$serendipity['GET']['page']</code>: Indicates the page number (for listing entries) for the Frontend</li>
  <li><code>$serendipity['GET']['lang_selected']</code>: Allows to change the Frontend/Backend language (ie “en”, “de” language keys)</li>
  <li><code>$serendipity['GET']['token']</code>: Some modules require token hashes to prevent XSS attacks</li>
  <li><code>$serendipity['GET']['category']</code>: Affects displaying entries, showing entries only belonging to this category ID (multiple categories separated by “;”).</li>
  <li><code>$serendipity['GET']['hide_category']</code>: Affects displaying entries, hide entries belonging to this category ID (multiple categories separated by “;”).</li>
  <li><code>$serendipity['GET']['viewAuthor']</code>: Affects displaying entries, only showing entries by this specific author ID (multiple authors separated by “;”).</li>
  <li><code>$serendipity['GET']['range']</code>: Affects displaying entries, only showing entries by this date range</li>
  <li><code>$serendipity['GET']['subpage']</code>: Can execute Frontend plugins (if not using their own rewrite-URL or external_plugin URL)</li>
  <li><code>$serendipity['GET']['searchTerm']</code>: If search is executed, holds the search term</li>
  <li><code>$serendipity['GET']['fullFeed']</code>: Boolean to indicate whether the full RSS feed is displayed (for “rss.php”)</li>
  <li><code>$serendipity['GET']['noBanner']</code>: Boolean to indicate if the Backend should show the banner</li>
  <li><code>$serendipity['GET']['noSidebar']</code>: Boolean to indicate if the Backend should show the menu sidebar</li>
  <li><code>$serendipity['GET']['noFooter']</code>: Boolean to indicate if the Backend should show the footer</li>
</ul>

<p>Note that a parameter like “index.php?serendipity[subpage]=XXX” gets converted to “$serendipity['GET']['subpage']=XXX”. But “index.php?subpage=YYY” will not exist in “$serendipity['GET']” due to it’s missing prefix.</p>

<p>On top of that, some global and user-specific configuration is passed through options saved in the database table serendipity_config. Those variables are defined in “include/tpl/config_local.inc.php” and “include/tpl/config_personal.inc.php”:</p>

<h5 id="docs-local-configuration">Local configuration</h5>

<ul class="plainList">
  <li><code>$serendipity['dbNames']</code>: Boolean whether to use “SET NAMES” charset directive in database layer</li>
  <li><code>$serendipity['uploadPath']</code>: Path to “uploads” directory</li>
  <li><code>$serendipity['templatePath']</code>: Path to “templates” directory”</li>
  <li><code>$serendipity['uploadHTTPPath']</code>: URL-path to “uploads” directory</li>
  <li><code>$serendipity['autodetect_baseURL']</code>: Boolean whether to enable autodetection of HTPP host name</li>
  <li><code>$serendipity['defaultBaseURL']</code>: When HTTP-Hostname autodetection is turned off, contains the default URL to Serendipity</li>
  <li><code>$serendipity['indexFile']</code>: Name to index.php (used for <a href="embedding.html">Embedded Installation</a>)</li>
  <li><code>$serendipity['permalinkStructure']</code>: Permalink for archives/ patterns</li>
  <li><code>$serendipity['permalinkAuthorStructure']</code>: Permalink for authors/ patterns</li>
  <li><code>$serendipity['permalinkCategoryStructure']</code>: Permalink for categories/ patterns</li>
  <li><code>$serendipity['permalinkFeedAuthorStructure']</code>: Permalink for feeds/authors/ patterns</li>
  <li><code>$serendipity['permalinkFeedCategoryStructure']</code>: Permalink for feeds/categories/ patterns</li>
  <li><code>$serendipity['permalinkArchivesPath']</code>: URL path for “archives view” detection</li>
  <li><code>$serendipity['permalinkArchivePath']</code>: URL path for “single entry” detection</li>
  <li><code>$serendipity['permalinkCategoriesPath']</code>: URL path for “category view” detection</li>
  <li><code>$serendipity['permalinkFeedsPath']</code>: URL path for “RSS feed” detection</li>
  <li><code>$serendipity['permalinkPluginPath']</code>: URL path for “external plugin” detection</li>
  <li><code>$serendipity['permalinkSearchPath']</code>: URL path for “search” detection</li>
  <li><code>$serendipity['permalinkAdminPath']</code>: URL path for “administration” detection</li>
  <li><code>$serendipity['permalinkAuthorsPath']</code>: URL path for “author view” detection</li>
  <li><code>$serendipity['permalinkCommentsPath']</code>: URL path for “comments” detection</li>
  <li><code>$serendipity['permalinkUnsubscribePath']</code>: URL path for “unsubscribe comment” detection</li>
  <li><code>$serendipity['permalinkDeletePath']</code>: URL path for “delete comment” detection</li>
  <li><code>$serendipity['permalinkApprovePath']</code>: URL path for “approve comment” detection</li>
  <li><code>$serendipity['blogTitle']</code>: Title of Blog</li>
  <li><code>$serendipity['blogDescription']</code>: Subtitle of Blog</li>
  <li><code>$serendipity['blogMail']</code>: E-Mail address of Blog (sending/receiving)</li>
  <li><code>$serendipity['allowSubscriptions']</code>: Boolean whether to allow users to subscribe to comments via email</li>
  <li><code>$serendipity['allowSubscriptionsOptIn']</code>: Boolean whether comment subscription requires opt-in confirmation</li>
  <li><code>$serendipity['useCommentTokens']</code>: Boolean whether to allow approving/deleting comments to the author of entries via email</li>
  <li><code>$serendipity['calendar']</code>: Which calendar to use</li>
  <li><code>$serendipity['lang_content_negotiation']</code>: Boolean whether user’s browser-language is used</li>
  <li><code>$serendipity['enablePluginACL']</code>: Boolean whether configuration of plugins applies permission checks</li>
  <li><code>$serendipity['updateCheck']</code>: Boolean whether performing update checks is allowed</li>
  <li><code>$serendipity['archiveSortStable']</code>: Boolean whether pagination URLs start with the pages enumerated from first or last page</li>
  <li><code>$serendipity['searchsort']</code>: Default sort order for sorting search results</li>
  <li><code>$serendipity['enforce_RFC2616']</code>: Boolean whether for RSS feeds Conditional Get may be used (see <a href="configuration.html#docs-appearance-and-options">Configuration</a>)</li>
  <li><code>$serendipity['useGzip']</code>: Boolean whether gzip’ing pages is enabled</li>
  <li><code>$serendipity['enablePopup']</code>: Boolean whether Popups are used in the Frontend (depends on the theme)</li>
  <li><code>$serendipity['embed']</code>: Boolean whether embedded mode is enabled (see <a href="configuration.html#docs-appearance-and-options">Configuration</a>)</li>
  <li><code>$serendipity['top_as_links']</code>: Boolean whether links outputted by exit/referrer tracking are clickable (anti-spam)</li>
  <li><code>$serendipity['trackReferer']</code>: Boolean whether referrer tracking is enabled</li>
  <li><code>$serendipity['blogReferer']</code>: List of referrer URL patters that shall be blocked</li>
  <li><code>$serendipity['useServerOffset']</code>: Boolean whether the timezone of the server and the authors differs</li>
  <li><code>$serendipity['serverOffsetHours']</code>: How many hours timezone difference are between server and authors</li>
  <li><code>$serendipity['showFuturEentries']</code>: Whether to show entries from the future</li>
  <li><code>$serendipity['enableACL']</code>: Boolean whether access-control checks are performed for entries, categories and media database items</li>
  <li><code>$serendipity['feedFull']</code>: Affects how entries are displayed in RSS feeds</li>
  <li><code>$serendipity['feedBannerURL']</code>: SYNDICATION_PLUGIN_BANNERURL</li>
  <li><code>$serendipity['feedBannerWidth']</code>: Width of banner image</li>
  <li><code>$serendipity['feedBannerHeight']</code>: Height of banner image</li>
  <li><code>$serendipity['feedShowMail']</code>: Whether to reveal authors email address in feeds</li>
  <li><code>$serendipity['feedManagingEditor']</code>: Specify the managing editor of the feeds</li>
  <li><code>$serendipity['feedWebmaster']</code>: Specify the webmaster of the feeds</li>
  <li><code>$serendipity['feedTtl']</code>: Specify the “time to live” on how often content gets updated</li>
  <li><code>$serendipity['feedPubDate']</code>: Whether to embed the publication date of a feed</li>
  <li><code>$serendipity['feedCustom']</code>: URL of a location to redirect feedreaders to</li>
  <li><code>$serendipity['feedForceCustom']</code>: Whether to force visitors to the redirected feed location even if they call the internal rss.php file</li>
  <li><code>$serendipity['magick']</code>: Boolean whether to use ImageMagick for converting images</li>
  <li><code>$serendipity['convert']</code>: Path to ImageMagick binary</li>
  <li><code>$serendipity['thumbSuffix']</code>: Suffix to append to converted image thumbnails</li>
  <li><code>$serendipity['thumbSize']</code>: Maximum Thumbnail dimension</li>
  <li><code>$serendipity['thumbConstraint']</code>: What to apply the maximum thumbnail dimension to</li>
  <li><code>$serendipity['maxFileSize']</code>: Maximum file size of uploaded files</li>
  <li><code>$serendipity['maxImgWidth']</code>: Maximum width for uploaded images</li>
  <li><code>$serendipity['maxImgHeight']</code>: Maximum height for uploaded images</li>
  <li><code>$serendipity['uploadResize']</code>: Boolean whether to resize images to maximum size before uploading</li>
  <li><code>$serendipity['onTheFlySynch']</code>: Boolean whether every call to the media database checks for updated files</li>
  <li><code>$serendipity['dynamicResize']</code>: Whether to allow Frontend visitors to resize thumbnails on demand</li>
  <li><code>$serendipity['mediaExif']</code>: Whether to parse EXIF information of uploaded files</li>
  <li><code>$serendipity['mediaProperties']</code>: Which meta information shall be available in the media database</li>
  <li><code>$serendipity['mediaKeywords']</code>: Specifies a list of available keywords to tag media files with</li>
</ul>

<h5 id="docs-personal-configuration">Personal Configuration</h5>

<ul class="plainList">
  <li><code>$serendipity['wysiwyg']</code>: Whether to use the WYSIWYG editor</li>
  <li><code>$serendipity['wysiwygToolbar']</code>: Defines the toolbar palette of the WYSIWYG editor</li>
  <li><code>$serendipity['mail_comments']</code>: Boolean whether a user receives comments to his entries via mail</li>
  <li><code>$serendipity['mail_trackbacks']</code>: Boolean whether a user receives trackbacks to his entries via mail</li>
  <li><code>$serendipity['no_create']</code>: If set, the author has no write permissions to anything in the Backend</li>
  <li><code>$serendipity['right_publish']</code>: Boolean to indicate if an author may publish entries (or only drafts)</li>
  <li><code>$serendipity['simpleFilters']</code>: Boolean whether simplified media and entry filter toolbars are shown</li>
  <li><code>$serendipity['enableBackendPopup']</code>: Boolean whether popups in the Backend are shown inline or as “real” popups</li>
  <li><code>$serendipity['moderateCommentsDefault']</code>: Boolean to indicate if new entries are moderated by default</li>
  <li><code>$serendipity['allowCommentsDefault']</code>: Boolean to indicate if new entries are able to be commented by default</li>
  <li><code>$serendipity['publishDefault']</code>: Indicates if new entries are saved as drafts or publish</li>
  <li><code>$serendipity['showMediaToolbar']</code>: Boolean whether to show toolbars for media library even in “picker” mode</li>
  <li><code>$serendipity['use_autosave']</code>: Boolean to indicate if browser’s autosave feature is used for entries</li>
</ul>

<h4 id="docs-important-api-functions">Important API functions</h4>

<p>We have created separate bundles for specific API functions. An overview of most relevant functions and where they are defined can be found here:</p>

<p><a href="functions.html">List of Important API functions</a></p>

<h4 id="docs-error-handling">Error-Handling</h4>

<p>By default, Serendipity sets the PHP error_reporting() to E_ALL without E_NOTICE and E_STRICT to prevent unnecessary PHP error output. When <code>$serendipity['production']</code> is set to “Debug”, E_STRICT errors will be shown.</p>

<p>Serendipity uses a default errorhandler (configured as <code>$serendipity['errorhandler']</code>, by default set to “errorToExceptionHandler” (defined in “include/compat.inc.php”). This will take care of emitting all error messages, and also ignore specific warnings that can be dealt with.</p>

<p>You can overwrite such an errorhandler in your “serendipity_config_local.inc.php” file by implementing your own function.</p>

<h3 id="docs-frontend-routing-indexphp">Frontend-Routing: “index.php”</h3>

<p>All of our Frontend routing is performed through the “index.php” file. Its code flow is like this:</p>

<ol>
  <li>Load “serendipity_config.inc.php” to initiate the Frontend (load functions, languages, database layers, central configuration, user configuration)</li>
  <li>Initialize Permalink patterns and lookup routines (serendipity_initPermalinks() and serendipity_permalinkPatterns()).</li>
  <li>Check what the current URL looks like and perform wanted action, parsing available parameters. Possibly execute plugins</li>
  <li>Call “include/genpage.inc.php” to setup the output for the required Smarty templates</li>
  <li>Initialize Smarty Framework, output template file</li>
</ol>

<p>Some examples:</p>

<h4 id="docs-archive-view">Archive view</h4>

<p>The Blog’s url “http://www.example.com/archives/2019/10/28.html” is called by the visitor.</p>

<p>Through the “.htaccess” file, “index.php” gets assigned to this page call. The “index.php” file instantiates the Serendipity framework by including the “serendipity_config.inc.php” file. It sets a view headers and sets up a few variables.</p>

<p>Now the central URL that was called is stored in <code>$uri</code>, and additional parameters (like the date: “2019-10-28”) get evaluated and stored in <code>$serendipity['uriArguments']</code>.</p>

<p>Now, multiple regular expressions check the <code>$uri</code> for each possible scenario that could happen. This means, the central PAT_ARCHIVES rule will evaluate true, and execute its workflow.</p>

<p>Inside this if-statement, the <code>$serendipity['uriArguments']</code> are parsed and operated on, so that possible categories, authors, week formats, pagination numbers or others are recognized. Those variables are stored in parameters like <code>$serendipity['GET']['page']</code> (pagination) for example.</p>

<p>In our case, the list only contains “2019”, “10” and “28”. Those are stored in the variables <code>$year</code>, <code>$month</code> and <code>$day</code>. According to the selected calendar (gregorian or persian) these variables are evaluated and passed along to <code>$ts</code> and <code>$te</code>. Those hold timestamps of the passed date minumum and maximum (here: “2019-10-28 00:00 to “2019-10-28 23:59).</p>

<p>Once all variables are setup, “include/genpage.inc.php” is called to create the usual Frontend view. This file checks based on <code>$serendipity['view']</code> which output and Smarty template files it needs to call, executes possible event plugins that listen on events, and after that, assign all data to the requested Smarty template.</p>

<p>This output is then emitted as <code>$data</code> from “index.php” to the browser.</p>

<h4 id="docs-external-plugin">External plugin</h4>

<p>The routing for executing a plugin like “http://www.example.com/pages/a-pagetitle.html” to match a staticpage plugin’s output is very similar to the example above.</p>

<p>The difference is that in this case the usual routing in “index.php” finds no specific pattern, and then goes to the “404” routing view. Once “include/genpage.inc.php” operates on that page, the plugin API event hook “genpage” is executed. The staticpage plugin has registered this event hook, and performs routines on its database tables to see if there is an entry that matches the current URL. If that is the case, it adjusts the Serendipity output and passes over its content.</p>

<h3 id="docs-backend-routing-serendipity_adminphp">Backend-Routing: “serendipity_admin.php”</h3>

<p>For the Serendipity Backend, all HTTP calls are routed through “serendipity_admin.php”. This file instantiates the Serendipity framework, sets up a couple of variables and then performs a central lookup on the URL GET (or POST) variable “?serendipity[adminModule]=XXX”. Before each module is included from the file in “include/admin/XXX.inc.php”, Serendipity performs permission checks to see if the user is authorized to access the given module.</p>

<p>Each of the modules (see below) performs their specific actions and evaluate the URL variable “?serendipity[adminAction]” to see, which action is performed (like creating an entry, updating an entry, viewing entries, etc.).</p>

<p>Each module passes its output and rendering data to a Backend Smarty template file, which gets saved in <code>$main_content</code> through output-buffering and finally assigns this output to Smarty and displays the “admin/index.tpl” template file.</p>

<h4 id="docs-backend-modules">Backend Modules</h4>

<p>The list of modules that are routable are:</p>

<ul>
  <li><strong>catgegory.inc.php</strong>: Category management</li>
  <li><strong>comments.inc.php</strong>: Comment management</li>
  <li><strong>configuration.inc.php</strong>: Blog configuration</li>
  <li><strong>entries.inc.php</strong>: Single Entry management</li>
  <li><strong>entries_ovewview.inc.php</strong>: Entry overview</li>
  <li><strong>groups.inc.php</strong>: Group / Access mangement</li>
  <li><strong>images.inc.php</strong>: Media database</li>
  <li><strong>import.inc.php</strong>: Import/Export</li>
  <li><strong>maintenance.inc.php</strong>: Maintenance of the Blog</li>
  <li><strong>overview.inc.php</strong>: The central dashboard</li>
  <li><strong>personal.inc.php</strong>: Personal preferences</li>
  <li><strong>plugins.inc.php</strong>: Plugin management</li>
  <li><strong>templates.inc.php</strong>: Theme management</li>
  <li><strong>upgrader.inc.php</strong>: Upgrader functionality</li>
  <li><strong>users.inc.php</strong>: User management</li>
</ul>

<h4 id="docs-importers--exporters">Importers / Exporters</h4>

<p>Serendipity supports importing from a lot of different systems. Each system is handled through a unified process put into their own files in the “include/admin/importers/” directory.</p>

<p>Each of those files is named like the system they stem from:</p>

<ul>
  <li><strong>b2evolution.inc.php</strong></li>
  <li><strong>bblog.inc.php</strong></li>
  <li><strong>blogger.inc.php</strong></li>
  <li><strong>bmachine.inc.php</strong></li>
  <li><strong>geeklog.inc.php</strong></li>
  <li><strong>lifetype.inc.php</strong></li>
  <li><strong>livejournal.inc.php</strong></li>
  <li><strong>moveabletype.inc.php</strong></li>
  <li><strong>nucleus.inc.php</strong></li>
  <li><strong>nuke.inc.php</strong></li>
  <li><strong>old_blogger.inc.php</strong></li>
  <li><strong>phpbb.inc.php</strong></li>
  <li><strong>pivot.inc.php</strong></li>
  <li><strong>pmachine.inc.php</strong></li>
  <li><strong>serendipity.inc.php</strong></li>
  <li><strong>smf.inc.php</strong></li>
  <li><strong>sunlog.inc.php</strong></li>
  <li><strong>textpattern.inc.php</strong></li>
  <li><strong>voodoopad.inc.php</strong></li>
  <li><strong>wordpress-pg.inc.php</strong></li>
  <li><strong>wordpress.inc.php</strong></li>
  <li><strong>generic.inc.php</strong>: Import through a generic RSS feed</li>
</ul>

<p>All files simple implement their own class that extends from Serendipity_Import and uses those methods. A good example is the “serendipity.inc.php” file for a Serendipity importer.</p>

<ul>
  <li><strong>getImportNotes</strong>: Displays specific information about what the importer does</li>
  <li><strong>Serendipity_Import_Serendipity</strong> (Constructor): Defines input GET/POST data as <code>$this-&gt;data</code> and populates <code>$this-&gt;inputFields</code> with a list of configuration options that the importer offers</li>
  <li><strong>validateData</strong>: Checks if all fields are populated</li>
  <li><strong>getInputFields</strong>: Wrapper function to return <code>$this-&gt;inputFields</code> (or custom variables)</li>
  <li><strong>import</strong>: Central function that is called, can access input data through <code>$this-&gt;data</code>.</li>
</ul>

<p>A class can now implement as many helper functions as it needs; The Serendipity importer uses one method for each kind of metadata it imports: import_cat, import_groups, import_authors and so on. All data is populated through another helper function import_table that performs the SQL queries for copying over data.</p>

<h3 id="docs-plugins">Plugins</h3>

<p>Serendipity can easily be enhanced by plugins. We have coined two different terms for two kinds of plugins.</p>

<p><strong>Event-Plugins</strong> are plugins that perform functionality based on events which are “fired” from the core on specific places, like when an entry is displayed, when an entry is saved and so on.</p>

<p><strong>Sidebar-Plugins</strong> are simple output plugins that are displayed on the Frontend of your Blog within a sidebar or footer, or header.</p>

<p>Both kinds of plugins can be enabled through the Admin interface, and they can be put into a custom order. For sidebar plugins the order simply visually arranges the output of plugins. For event plugins, the order indicates which plugin gets executed first, which can in turn influence the “pipeline” of plugins coming after that. This is mostly important for Markup plugins that affect the rendering of Blog entries: If one event plugin takes care of translating glossary terms to full links, and another plugin is used to mark internal and external links graphically, it would be important the the glossary plugin gets executed first, so that the link-marking plugin can also take care of glossary links. There is no “proper” order of plugins, it all depends on the specific combination of these.</p>

<p>A plugin is defined by the files in the “plugins/” subdirectory. Each plugin has its own distinct directory name which must conform to a prefix “serendipity_plugin_XXX” for sidebar plugins and “serendipity_event_XXX” for event plugins. The same name must then be repeated as the filename of the “.php” file within that directory.</p>

<p>Plugin files within those directories are then only loaded, if you have activated/installed that plugin through the Admin interface.</p>

<p>To see how the plugin files must be coded, please refer to our <a href="plugin-api.html">Plugin API Documentation</a>.</p>

<h3 id="docs-themes">Themes</h3>

<p>Historically, Serendipity used the term “Theme”, “Template” or “Style” to express the same term. We have tried to completely remove the term “Style”, and now use “Theme” to describe a collection of single Smarty template files.</p>

<p>So whenever we say “Theme”, we mean that what an end-user selects to affect output. And when we say “Template”, we refer to an actual, single file.</p>

<p>Our themes are built upon single Smarty template files. Each file is responsible for a specific aspect of Frontend or Backend display. Serendipity implements both Frontend and Backend themes, so that you can basically build your own Backend. The drawback to building a custom Backend of course is, that anytime we add new functionality, we only add this to our internal default theme. We suggest to only make visual changes on the CSS side of things, unless you know what you are doing.</p>

<p>A description for how themes are built, which variables they refer to please check the <a href="themes.html">Theme Documentation</a>.</p>

<h3 id="docs-coding-guidelines">Coding Guidelines</h3>

<p>Serendipity has been around since 2002, and code has been gradually built upon the same core. This has advantages (stability, adaptability, compatibility), and also disadvantages (“old flair”, mixed code patterns).</p>

<p>Most notably it shows that Serendipity does not use specific object-oriented patterns (aside from the Plugin API), and adheres to functional approaches. This has the advantage of being really easy to understand and read.</p>

<p><strong>Versioning</strong>:</p>
<ul>
    <li>Serendipity follows a <a href="http://semver.org">semantic versioning scheme</a>.

    <ul>
      <li><strong>Major versions</strong> (like 1.0, 2.0) introduce new features and can possibly affect backwards compatibility and APIs.</li>
      <li><strong>Minor versions</strong> (like 2.1.0) can introduce new main features.</li>
      <li><strong>Bugfix versions</strong> (like 2.0.3) only introduce bugfixes and very minor new features.</li>
    </ul>
    </li>
    <li>Plugin versions should usually be incremented in the same way.</li>

    <li>Plugins can be removed/deprecated from the central <a href="/plugins/">Spartacus repository</a>, if:

    <ul>
      <li>they are broken and no longer work, maybe because depending on external functionality that is no longer available</li>
      <li>there are critical issues with a plugin and no maintainer can be found</li>
      <li>there are better plugins that provide the same functionality</li>
    </ul>
    </li>

    <li>By removing them from Spartacus, users who have the plugin installed (and because of any reason want to keep using them) could do that, because Serendipity would not delete them.</li>

    <li>When a plugin is removed from Spartacus, the development team will write a Blog announcement post to inform users who have the plugin installed so that they can remove them themselves (or maybe even better, volunteer to fix/improve it).</li>

    <li>If users find plugins that no longer work and should be marked as deprecated, please report this on our issue tracker or on the forums, so that we can take action.</li>
</ul>

<p><strong>General coding rules</strong>:</p>

<ul>
  <li>Use 4 spaces to indent code</li>
  <li>Put opening braces on the same line like the preceding logic, put closing braces on a new line:
    <pre><code>if (condition) {
    // code
}

function serendipity_function($var1, $var2, $var3) {
    // code
}</code></pre>
  </li>
  <li>Add spaces after commas, add spaces before and after string concatenation ($var = $var1 . $var2)</li>
  <li>Use easy-to-read IF-statements, try to only use ternary IFs where it’s well readable</li>
  <li>Use single-quotes for array keys and strings</li>
  <li>Indent SQL statements with newlines for readability</li>
  <li>Add phpDoc style inline code documentation for function parameters etc.</li>
  <li>Prefix framework function names with serendipity_ and after that, use camelCase naming</li>
  <li>Try to use camelCase naming for new variables (currently, there is a mixture of function/variable names with underscore characters and camelCasing)</li>
  <li>Always escape HTML output of unsafe user input with serendipity_specialchars()</li>
  <li>If your code/plugin uses administrative tasks in the Backend, make sure you use the serendipityFormToken() functions to protect against XSRF.</li>
  <li>Always escape database input of unsafe user input with either implicit typecasting (int)$_REQUEST['var'] or serendipity_db_escape_string()</li>
  <li>Write database-agnostic standard SQL wherever possible; If you require database-specific SQL, add codeforks with a switch($serendipity['dbType']) statement.</li>
  <li>Try to cache results that come from foreign URLs. If your plugins displays an RSS feed, it shouldn’t be fetched each execution cycle of the plugin, but rather only every X minutes. Provide a configuration option to let the user configure his own caching period.</li>
  <li>Always abstract any output messages with language constants. Always include an english language file of your plugin.</li>
  <li>If you enhance functionality of a plugin, please add a file called “ChangeLog” documenting changes. If you fix core code or add new functionality in the core, document this in docs/NEWS.</li>
  <li>If you bundle foreign code, make sure you indicate the right licensing of your plugins. By default, a Serendipity plugin is BSD licensed.</li>
  <li>If your plugin has foreign code dependencies, either include those in the plugin or make sure, your plugin does not bail out with a fatal error otherwise. It should always alarm the user what’s missing.</li>
  <li>Closing Words: Take a look at existing plugins. What has worked in the past, might work out for you as a draft for your own plugin.</li>
</ul>

                </div>
            </div>
        </div>
        <div class="blog-post__footer">
            <div class="blog-post__footer-author site-col__footer-author-container">
                <div class="blog-post__author-avatar-container">
                    <div class="blog-post__author-avatar blog-post__author-avatar--ophian"></div>
                </div>
                <div class="blog-post__author-description">
                    <h3>Ian Styx (ophian)<span>Maintainer</span></h3>
                    <p class="follow"><a href="https://github.com/ophian/styx/issues" title="Styx issues" target="_blank">@ophian</a></p>
                    <p>John Ian Styx has more than 17 years of experience in the IT market as a developer and from 2003 as a Serendipity lover.</p>
                </div>
            </div>
        </div>
    </section>
</main>
<div class="addthis_float_share_toolbox"></div>
<footer class="footer footer--blog" role="contentinfo">
    <div class="section-container footer-site-map">
        <div class="row footer-menu__row">
            <div class="col-xs-12 col-sm-4 footer-menu__container">
                <div class="footer-menu__wrapper" role="navigation" aria-labelledby="menu-category-1-0">
                    <h2 id="menu-category-1-0">Repository</h2>
                    <ul class="footer-menu">
                        <li><a class="icon icon--small" href="https://github.com/ophian/styx/releases" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Downloads</a></li>
                        <li><a class="icon icon--small" href="https://github.com/ophian/styx" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Code</a></li>
                        <li><a class="icon icon--small" href="https://github.com/ophian/additional_plugins" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Plugins</a></li>
                        <li><a class="icon icon--small" href="https://github.com/ophian/styx/issues" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Issues</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 col-sm-4 footer-menu__container">
                <div class="footer-menu__wrapper" role="navigation" aria-labelledby="menu-category-1-1">
                    <h2 id="menu-category-1-1">Site & Documentation</h2>
                    <ul class="footer-menu">
                        <li class="icon-site"><a href="/">Serendipity Styx Home</a></li>
                        <li class="icon-site"><a href="/blog/">Serendipity Styx Blog</a></li>
                        <li class="icon-site"><a href="/book/">Serendipity Styx Book [de]</a></li>
                        <li class="icon-site"><a href="/plugins/">Serendipity Styx Plugins</a></li>
                        <li class="icon-site"><a href="/themes/">Serendipity Styx Themes</a></li>
                        <li class="icon-site"><a href="/hc/en/faq/">Serendipity Styx FAQ</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-xs-12 col-sm-4 footer-menu__container">
                <div class="footer-menu__wrapper" role="navigation" aria-labelledby="menu-category-1-2">
                    <h2 id="menu-category-1-2">Connect with Styx</h2>
                    <ul class="footer-menu">
                        <li class="icon-site"><a href="/contact/">Contact us</a></li>
                        <li class="icon-site"><a href="/hc/">Help center</a></li>
                        <li class="icon-site"><a href="/about/">About Styx</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-mobile" role="navigation" aria-hidden="true" data-mobile="true">
        <div class="section-container">
            <div class="row">
                <div class="col-xs-12 col-sm-6 footer-mobile__column">
                    <h2>Repository</h2>
                    <ul class="footer-mobile__menu">
                        <li><a class="icon icon--small" href="https://github.com/ophian/styx/releases" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Downloads</a></li>
                        <li><a class="icon icon--small" href="https://github.com/ophian/styx" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Code</a></li>
                        <li><a class="icon icon--small" href="https://github.com/ophian/additional_plugins" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Plugins</a></li>
                        <li><a class="icon icon--small" href="https://github.com/ophian/styx/issues" target="_blank" rel="noopener"><svg class="icon__body"><use xlink:href="#github"></use></svg> Serendipity Styx Issues</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-6 footer-mobile__column">
                    <h2>Connect with Styx</h2>
                    <ul class="footer-mobile__menu">
                        <li class="icon-site"><a href="/contact/">Contact us</a></li>
                        <li class="icon-site"><a href="/about/">About Styx</a></li>
                        <li class="icon-site"><a href="/hc/">Help center</a></li>
                        <li class="icon-site"><a href="/">Serendipity Styx Home</a></li>
                        <li class="icon-site"><a href="/blog/">Serendipity Styx Blog</a></li>
                        <li class="icon-site"><a href="/book/">Serendipity Styx Book [de]</a></li>
                        <li class="icon-site"><a href="/plugins/">Serendipity Styx Plugins</a></li>
                        <li class="icon-site"><a href="/themes/">Serendipity Styx Themes</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="section-container footer-policy">
        <div class="row">
            <div class="col-xs-12 col-md-6">
                <p class="footer-policy__rights">© 2016 - 2018 Serendipity Styx Edition.</p>
            </div>
            <div class="col-xs-12 col-md-6">
                <ul class="footer-policy__menu">
                    <li class="footer-policy__menu-item"><a href="/legal/">Legal</a></li>
                    <li class="footer-policy__menu-item"><a href="/legal/privacy/">Privacy policy</a></li>
                    <li class="footer-policy__menu-item"><a href="https://opensource.org/docs/definition.php" target="_blank">Open Source</a></li>
                </ul>
            </div>
        </div>
    </div>
</footer>
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
	<svg id="github" viewBox="0 0 24 24">
		<title id="simpleicons-github-icon">GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path>
	</svg>
</svg>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>window.jQuery || document.write('<script src="/js/jquery-3.2.1.min.js"><\/script>')</script>
<script src="/js/jquery.ui.totop.js" type="text/javascript"></script>
<script> 
    $(function(){
        $(document).ready(function() {
            $().UItoTop();
        });
    });
</script>
<a href="#" id="toTop" style="display: inline;"><span id="toTopHover"></span>To Top</a>
<script src="/js/styx.min.js"></script>
</body></html>